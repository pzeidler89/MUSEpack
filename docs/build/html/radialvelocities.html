

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Spectral line fitting and radial velocity measurements &mdash; MUSEpack 1.0.2_legacy documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Cubes" href="cubes.html" />
    <link rel="prev" title="2. MUSEreduce" href="MUSEreduce.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> MUSEpack
          

          
          </a>

          
            
            
              <div class="version">
                1.0.2 legacy
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">1. Installing MUSEpack</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#additional-python-packages">1.1. Additional python packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#additional-3rd-party-software">1.2. Additional 3rd party software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="MUSEreduce.html">2. MUSEreduce</a><ul>
<li class="toctree-l2"><a class="reference internal" href="MUSEreduce.html#the-basic-folder-structure">2.1. The basic folder structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="MUSEreduce.html#the-config-file">2.2. The config file</a></li>
<li class="toctree-l2"><a class="reference internal" href="MUSEreduce.html#utility-methods">2.3. Utility methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="MUSEreduce.html#history">2.4. History</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Spectral line fitting and radial velocity measurements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#spectral-line-fitter">3.1. Spectral line fitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">3.2. Radial Velocities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-radial-velocity-fitter">3.2.1. The radial velocity fitter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#monte-carlo-radial-velocity-determination">3.2.2. Monte Carlo radial velocity determination</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#history">3.3. History</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cubes.html">4. Cubes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cubes.html#history">4.1. History</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">5. Utility module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="utilities.html#history">5.1. History</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">6. Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#measuring-stellar-radial-velocities">6.1. Measuring stellar radial velocities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples.html#the-procedure">6.1.1. The procedure</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples.html#the-results">6.1.2. The results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#additional-tutorials">6.2. Additional tutorials</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Credits:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
</ul>
<p class="caption"><span class="caption-text">Disclaimer:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="disclaimer.html">Disclaimer</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MUSEpack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><span class="section-number">3. </span>Spectral line fitting and radial velocity measurements</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/radialvelocities.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spectral-line-fitting-and-radial-velocity-measurements">
<span id="radial-velocities"></span><h1><span class="section-number">3. </span>Spectral line fitting and radial velocity measurements<a class="headerlink" href="#spectral-line-fitting-and-radial-velocity-measurements" title="Permalink to this headline">¶</a></h1>
<p>The main purpose of MUSEreduce is the spectral line fitting in order to create template spectra from observations, which are used to measure the radial velocities of stars and gas, especially in the absence of working spectral template libraries, e.g., for pre-main-sequence stars in the optical.</p>
<p>The <a class="reference internal" href="#radial_velocities.RV_spectrum" title="radial_velocities.RV_spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">radial_velocities.RV_spectrum</span></code></a> class and the spectral fitting module <a class="reference internal" href="#module-line_fitter" title="line_fitter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">line_fitter</span></code></a> are the heart of this package using <a class="reference external" href="https://pyspeckit.readthedocs.io/en/latest/index.html">pyspeckit</a> as basic spectral fitting routine and <a class="reference external" href="http://www-astro.physics.ox.ac.uk/~mxc/software/#ppxf">ppxf</a> for the spectral cross-correlation. Together with a Monte Carlo bootstrap technique, it is possible to measure radial velocities with an accuracy of <span class="math notranslate nohighlight">\(1-3\,\rm{km}\,\rm{s}^{-1}\)</span> in the absence of any template library. For a detailed description on how this technique works, we refer to <a class="reference external" href="www.xyz.com">Zeidler et al. 2019</a>.</p>
<div class="section" id="spectral-line-fitter">
<h2><span class="section-number">3.1. </span>Spectral line fitter<a class="headerlink" href="#spectral-line-fitter" title="Permalink to this headline">¶</a></h2>
<p>This module is the work horse for fitting spectral lines from an input catalog to a given 1D spectrum. The line fitting itself is performed using the module <a class="reference external" href="https://pyspeckit.readthedocs.io/en/latest/index.html">pyspeckit</a>.</p>
<p><a class="reference external" href="https://pyspeckit.readthedocs.io/en/latest/index.html">pyspeckit</a> uses an iterative method to fit the spectral lines and the continuum simultaneously. <a class="reference internal" href="#module-line_fitter" title="line_fitter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">line_fitter</span></code></a> automatically adjusts the input parameters to <a class="reference external" href="https://pyspeckit.readthedocs.io/en/latest/index.html">pyspeckit</a> in the manner to optimize the fitting (<em>continuum order</em> and <em>wavelegth limits</em>)</p>
<p>The <a class="reference internal" href="#module-line_fitter" title="line_fitter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">line_fitter</span></code></a> determines whether the fit fullfils the set parameters and was succesfull. The <a class="reference internal" href="#module-line_fitter" title="line_fitter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">line_fitter</span></code></a> also allows to fit blends by fixing a maximum ratio between the primary line (the one the user is interested in) and the secondary line (blend). This ensures that the blend does not become the dominant line.</p>
<p>In order to accomodate hyper-velocity stars an option is given that the wavelength limits are automatically adjust for each iteration <span class="math notranslate nohighlight">\(n\)</span> based on the solution <span class="math notranslate nohighlight">\(n-1\)</span> of the primary line taking into account <span class="math notranslate nohighlight">\(\Delta \lambda / \lambda\)</span>.</p>
<span class="target" id="module-line_fitter"></span><dl class="function">
<dt id="line_fitter.line_fitter">
<code class="sig-prename descclassname">line_fitter.</code><code class="sig-name descname">line_fitter</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">linecat</em>, <em class="sig-param">line_idx</em>, <em class="sig-param">niter</em>, <em class="sig-param">input_resid_level</em>, <em class="sig-param">max_contorder</em>, <em class="sig-param">max_ladjust</em>, <em class="sig-param">adjust_preference</em>, <em class="sig-param">input_continuum_deviation</em>, <em class="sig-param">llimits</em>, <em class="sig-param">max_exclusion_level</em>, <em class="sig-param">blends</em>, <em class="sig-param">autoadjust</em>, <em class="sig-param">fwhm_block</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/line_fitter.html#line_fitter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#line_fitter.line_fitter" title="Permalink to this definition">¶</a></dt>
<dd><p>This is module fits the spectral lines using pyspeckit. It automatically
determines the goodness of fit and decides the best solution for the line
and continuum fit. It handles blended lines in a way a maximum lines ratio
can not be exceeded to not make the weaker blend the dominant lines.
Additionally, the limits in wavelength range in iteration <span class="math notranslate nohighlight">\(n\)</span> can be
adjusted automatically based on iteration <span class="math notranslate nohighlight">\(n\)</span> to accomodate for
larger wavelength shifts.</p>
<p>In this way it is possible to fit spectral lines using a line catalog as 
only input.</p>
<dl>
<dt>Args:</dt><dd><dl>
<dt>linecat<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>Array with the spectral lines and their wavelengths</p>
</dd>
<dt>line_idx<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a></span></dt><dd><p>Name of the primary line</p>
</dd>
<dt>niter<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a></span></dt><dd><p>Number of iterations</p>
</dd>
<dt>input_resid_level<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></span></dt><dd><p>The maximum MAD for the fit residuals for a succesfull fit</p>
</dd>
<dt>max_contorder<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a></span></dt><dd><p>The maximum polynominal order of the continuum to have</p>
</dd>
<dt>max_ladjust<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a></span></dt><dd><p>The maximum number of wavelength range adjustments in steps of 5
Angstrom</p>
</dd>
<dt>adjust_preference<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a></span></dt><dd><p>contorder: continuum order is adjusted first</p>
<p>wavelength: wavelength range is adjusted first</p>
</dd>
<dt>input_continuum_deviation<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></span></dt><dd><p>by how much the continuum is allowed to deviate from a running
median estimate. This is set to prevent lines mimicking a continuum</p>
</dd>
<dt>llimits<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a></span></dt><dd><p>the limits for the wavelength fit as set in <code class="docutils literal notranslate"><span class="pre">ppxf</span></code></p>
</dd>
<dt>max_exclusion_level<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></span></dt><dd><p>The exclusion level for lines to be excluded from the next baseline
estimate as set in <code class="docutils literal notranslate"><span class="pre">pyspeckit</span></code></p>
</dd>
<dt>blends<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#ascii" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ascii</span></code></a>-file or <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a></span></dt><dd><p>A file with primary lines that contain blends to provide a maximum
amplitude ratio of the primary and the blend to prevent that the
blend becomes the dominant line in the fit.</p>
</dd>
<dt>autoadjust<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a></span></dt><dd><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>: the wavelength limits <code class="docutils literal notranslate"><span class="pre">llimit</span></code> will be adjusted to
the fit of the previous iteration. All other wavelength range are
adjusted accordingly taking into account the proper velocity
corrected shift <span class="math notranslate nohighlight">\(\Delta \lambda/\lambda\)</span>. This is especially
important to detect hyper-velocity stars.</p>
<p><a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>: no adjustment to the limits done</p>
</dd>
<dt>fwhm_block<span class="classifier"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool:obj:</span></code></span></dt><dd><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>: The minimum fwhm of the voigt profiles of the fitted
lines is the instrument’s dispersion</p>
<p><a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>: The minimum fwhm of the voigt profiles of the fitted
lines is zero</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><dl>
<dt>line_idx<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a></span></dt><dd><p>Name of the primary line</p>
</dd>
<dt>temp_l<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></span></dt><dd><p>fitted wavelength of the primary line</p>
</dd>
<dt>temp_a<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></span></dt><dd><p>fitted amplitude of the primary line</p>
</dd>
<dt>temp_sl<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></span></dt><dd><p>fitted Lorentzian gamma of the primary line</p>
</dd>
<dt>temp_sg<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></span></dt><dd><p>fitted Gaussian sigma of the primary line</p>
</dd>
<dt>spec_select_idx<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>indices of the used part of the spectrum</p>
</dd>
<dt>template_f<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>template spectrum shifted to the rest-frame</p>
</dd>
<dt>continuum<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>the fitted continuum</p>
</dd>
<dt>lstart<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></span></dt><dd><p>first used wavelength bin (might differ from input if it was
adjusted during fitting)</p>
</dd>
<dt>lend<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></span></dt><dd><p>last used wavelength bin (might differ from input if it was
adjusted during fitting)</p>
</dd>
<dt>contorder<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a></span></dt><dd><p>The order of the polynominal used for the continuum</p>
</dd>
<dt>fit_f<span class="classifier">array</span></dt><dd><p>the fitted spectrum</p>
</dd>
<dt>significance<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></span></dt><dd><p>the line strength over the continuum</p>
</dd>
<dt>fit_failed<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a></span></dt><dd><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>: if the fit failed for some reason. This line will be
excluded from further analyses</p>
</dd>
<dt>fit_f_highres<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></span></dt><dd><p>the fitted spectrum and the oversampling resolution</p>
</dd>
<dt>spec_select_idx_highres<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>indices of the used part of the over sampled spectrum</p>
</dd>
<dt>template_f_highres<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>over sampled template spectrum shifted to the rest-frame</p>
</dd>
<dt>continuum_highres<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>the fitted over sampled continuum</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The automatic handling of absorption and emission lines implemented in vers. 0.1.2 has not been tested yet.</p>
</div>
</div>
<div class="section" id="id2">
<h2><span class="section-number">3.2. </span>Radial Velocities<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>This is the main class for measuring the radial velocities. A basic example is descibed in <a class="reference internal" href="examples.html#examples"><span class="std std-ref">Examples</span></a>. A detailed description can be found in Zeidler et al. 2019.</p>
<p>Throughout the document the <strong>primary line</strong> is the spectral line of interest for which the line fitting will be executed. <strong>Secondary lines</strong> are spectral lines in blends.</p>
<p>A detailed demonstration on how to use the radial velocity fitter is provided in <a class="reference internal" href="examples.html#examples"><span class="std std-ref">Examples</span></a> including template files.</p>
<div class="section" id="the-radial-velocity-fitter">
<h3><span class="section-number">3.2.1. </span>The radial velocity fitter<a class="headerlink" href="#the-radial-velocity-fitter" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="radial_velocities.RV_spectrum">
<em class="property">class </em><code class="sig-prename descclassname">radial_velocities.</code><code class="sig-name descname">RV_spectrum</code><span class="sig-paren">(</span><em class="sig-param">spec_id</em>, <em class="sig-param">spec_f</em>, <em class="sig-param">spec_err</em>, <em class="sig-param">spec_lambda</em>, <em class="sig-param">loglevel='INFO'</em>, <em class="sig-param">templatebins=100000</em>, <em class="sig-param">specbinsize=1.25</em>, <em class="sig-param">dispersion=2.4</em>, <em class="sig-param">linetype='absorption'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/radial_velocities.html#RV_spectrum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radial_velocities.RV_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>This class contains the 1D spectrum, as well as all fitting parameters
and output values including the radial velocity catalog.</p>
<dl>
<dt>Args:</dt><dd><dl>
<dt>spec_id<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a></span></dt><dd><p>unique identifier of the spectrum</p>
</dd>
<dt>spec_f<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>flux array of the spectrum in erg/s/cm:math:<cite>^2</cite>/Angstrom</p>
</dd>
<dt>spec_err<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>flux uncertainty array of the spectrum</p>
</dd>
<dt>spec_lambda<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>wavelength_array of the spectrum in Angstrom</p>
</dd>
</dl>
</dd>
<dt>Kwargs:</dt><dd><dl>
<dt>loglevel<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> (optional, default: <code class="docutils literal notranslate"><span class="pre">INFO</span></code>)</span></dt><dd><p><code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>: all functions run on a single core to obtain proper
output in the correct order for proper debugging.</p>
</dd>
<dt>templatebins<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> (optional, default: 100000)</span></dt><dd><p>Number of wavelength bins for the oversampled spectrum used to fit
the spectral lines.</p>
</dd>
<dt>specbinsize<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> (optional, default: 1.25)</span></dt><dd><p>The spectral bin size. The default is set to fit the MUSE dataset</p>
</dd>
<dt>dispersion<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> (optional, default: 2.4)</span></dt><dd><p>The dispersion of the spectrograph. The default is set to the
nominal MUSE instrument dispersion</p>
</dd>
<dt>linetype: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> (optional, default: absorption)</dt><dd><p>absorption: All spectral lines are absorption lines</p>
<p>emission: All spectral lines are emission lines</p>
<p>both : spectral lines can be absorption or emission lines. <strong>This</strong>
<strong>mode has not been tested yet !!!</strong></p>
</dd>
</dl>
</dd>
</dl>
<dl class="method">
<dt id="radial_velocities.RV_spectrum.catalog">
<code class="sig-name descname">catalog</code><span class="sig-paren">(</span><em class="sig-param">initcat=None</em>, <em class="sig-param">save=False</em>, <em class="sig-param">load=None</em>, <em class="sig-param">printcat=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/radial_velocities.html#RV_spectrum.catalog"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radial_velocities.RV_spectrum.catalog" title="Permalink to this definition">¶</a></dt>
<dd><p>This module handles the catalog that holds the fit results
of the primary lines.</p>
<dl>
<dt>Kwargs:</dt><dd><dl>
<dt>initcat<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#ascii" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ascii</span></code></a> (optional, default: <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>)</span></dt><dd><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#ascii" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ascii</span></code></a> file containing the primary lines
format: name, lambda, start, end</p>
</dd>
<dt>save<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a> (optional, default: <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>)</span></dt><dd><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>: The catalog is written to a file.</p>
</dd>
<dt>load<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> (optional, default: <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>)</span></dt><dd><p>Loads a catalog from catalog file.</p>
</dd>
<dt>printcat<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a> (optional, default: <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>)</span></dt><dd><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>: The catalog is printed to the terminal</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="radial_velocities.RV_spectrum.clean">
<code class="sig-name descname">clean</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/radial_velocities.html#RV_spectrum.clean"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radial_velocities.RV_spectrum.clean" title="Permalink to this definition">¶</a></dt>
<dd><p>This modules resets all of the output. This <strong>must</strong> be executed before
repeating the spectral fit without re-initiating the class.</p>
</dd></dl>

<dl class="method">
<dt id="radial_velocities.RV_spectrum.line_fitting">
<code class="sig-name descname">line_fitting</code><span class="sig-paren">(</span><em class="sig-param">input_cat, line_idxs, niter=5, n_CPU=-1, resid_level=None, max_contorder=2, max_ladjust=4, adjust_preference='contorder', input_continuum_deviation=0.05, llimits=[-2.0, 2.0], max_exclusion_level=0.3, blends=None, autoadjust=False, fwhm_block=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/radial_velocities.html#RV_spectrum.line_fitting"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radial_velocities.RV_spectrum.line_fitting" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializing the line fitting by calling <a class="reference internal" href="#module-line_fitter" title="line_fitter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">line_fitter</span></code></a></p>
<dl>
<dt>Args:</dt><dd><dl class="simple">
<dt>input_cat: <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></dt><dd><p>input spectral line catalog with wavelengths in Angstrom</p>
</dd>
<dt>line_idxs: <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></dt><dd><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a>: of the line names for which RV
fits should be performed, must be identical to “name” in
init_cat</p>
</dd>
</dl>
</dd>
<dt>Kwargs:</dt><dd><dl>
<dt>niter<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 5)</span></dt><dd><p>The maximum number of iteration if convergence is not reached</p>
</dd>
<dt>n_CPU<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> (optional, default: -1)</span></dt><dd><p>Setting the number of CPUs used for the parallelization. If set
to -1 all available system resources are used. Maximum number of
CPUs is the number of spectral lines the fit is performed on.</p>
</dd>
<dt>resid_level: <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> (optional, default: None)</dt><dd><p>The maximum MAD for the fit residuals for a succesfull fit</p>
</dd>
<dt>max_contorder<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 2)</span></dt><dd><p>The maximum polynominal order of the continuum</p>
</dd>
<dt>max_ladjust<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 4)</span></dt><dd><p>Ahe maximum number of wavelength range adjustments in steps of 5
Angstrom</p>
</dd>
<dt>adjust_preference: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> (optional, default: contorder)</dt><dd><p><code class="docutils literal notranslate"><span class="pre">contorder</span></code>: continuum order is adjusted first</p>
<p><code class="docutils literal notranslate"><span class="pre">wavelength</span></code>: wavelength range is adjusted first</p>
</dd>
<dt>input_continuum_deviation <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> (optional, default: 0.05)</dt><dd><p>Fraction by how much the continuum is allowed to deviate from a
running median estimate. This is set to prevent lines mimicking
a continuum</p>
</dd>
<dt>llimits: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a> (optional, default: [-2., 2.])</dt><dd><p>the limits for the wavelength fit as set in <a class="reference external" href="http://www-astro.physics.ox.ac.uk/~mxc/software/#ppxf">ppxf</a></p>
</dd>
<dt>max_exclusion_level <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> (optional, default: 0.3)</dt><dd><p>The exclusion level for lines to be excluded from the next
baseline estimate as set in <a class="reference external" href="https://pyspeckit.readthedocs.io/en/latest/index.html">pyspeckit</a></p>
</dd>
<dt>blends: <a class="reference external" href="https://docs.python.org/3/library/functions.html#ascii" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ascii</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> (optional, default: None)</dt><dd><p>A file with primary lines that contain blends to provide a
maximum amplitude ratio of the primary and the blend to prevent
that the blend becomes the dominant line in the fit.</p>
</dd>
<dt>autoadjust <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a> (optional, default: <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>)</dt><dd><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>: the wavelength limits <code class="docutils literal notranslate"><span class="pre">llimit</span></code> will be adjusted
to the fit of the previous iteration. All other wavelength
range are adjusted accordingly taking into account the proper
velocity corrected shift <span class="math notranslate nohighlight">\(\Delta \lambda/\lambda\)</span>. This
is especially important to detect hyper-velocity stars.</p>
</dd>
<dt>fwhm_block <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a> (optional, default: <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>)</dt><dd><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>: The minimum fwhm of the voigt profiles of the
fitted lines ais the instrument’s dispersion. This prevents
unphysical lines.</p>
<p><a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>: The minimum fwhm of the voigt profiles of the
fitted lines is zero.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="radial_velocities.RV_spectrum.plot">
<code class="sig-name descname">plot</code><span class="sig-paren">(</span><em class="sig-param">oversampled=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/radial_velocities.html#RV_spectrum.plot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radial_velocities.RV_spectrum.plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the spectrum and the regions of the primary lines to a file
including the spectral fit and the template.</p>
<dl>
<dt>Kwargs:</dt><dd><dl>
<dt>oversampled<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a> (optional, default: <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>)</span></dt><dd><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>: The oversampled spectral fit and the template are
used in the plot.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="radial_velocities.RV_spectrum.rv_fit">
<code class="sig-name descname">rv_fit</code><span class="sig-paren">(</span><em class="sig-param">guesses</em>, <em class="sig-param">niter=10000</em>, <em class="sig-param">line_sigma=3</em>, <em class="sig-param">n_CPU=-1</em>, <em class="sig-param">line_significants=5</em>, <em class="sig-param">RV_guess_var=0.0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/radial_velocities.html#RV_spectrum.rv_fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radial_velocities.RV_spectrum.rv_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>The module runs the radial velocity fit using <a class="reference external" href="http://www-astro.physics.ox.ac.uk/~mxc/software/#ppxf">ppxf</a> and the 
<a class="reference internal" href="#monte-carlo"><span class="std std-ref">Monte Carlo radial velocity determination</span></a>.</p>
<dl>
<dt>Args:</dt><dd><dl>
<dt>guesses<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>The initial guesses for the the radial velocity fit guesses in
the form [RV,sepctral_dispersion]</p>
</dd>
</dl>
</dd>
<dt>Kwargs:</dt><dd><dl>
<dt>niter<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 10000)</span></dt><dd><p>number of iterations to bootstrap the spectrum</p>
</dd>
<dt>line_sigma: <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 3):</dt><dd><p>sigma for the RV clipping for the individual lines</p>
</dd>
<dt>n_CPU<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> (optional, default: -1)</span></dt><dd><p>Setting the number of CPUs used for the parallelization. If set 
to -1 all available system resources are used. Maximum number of
CPUs is the number of spectral lines the fit is performed to.</p>
</dd>
<dt>line_significants: <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 5)</dt><dd><p>The sigma-level for the spectral line to be above the continuum
in order to be considered <em>valid</em></p>
</dd>
<dt>RV_guess_var<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> (optional, default: 0)</span></dt><dd><p>The maximum variation the RV guess will be varied using a 
uniform distribution.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="radial_velocities.RV_spectrum.rv_fit_peak">
<code class="sig-name descname">rv_fit_peak</code><span class="sig-paren">(</span><em class="sig-param">line_sigma=3</em>, <em class="sig-param">line_significants=5</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/radial_velocities.html#RV_spectrum.rv_fit_peak"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radial_velocities.RV_spectrum.rv_fit_peak" title="Permalink to this definition">¶</a></dt>
<dd><p>This module determines the radial velocity solely on the fitted peaks
of the spectral lines</p>
<dl>
<dt>Kwargs:</dt><dd><dl>
<dt>line_sigma<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 3)</span></dt><dd><p>The sigma-level for the sigma clipping before determining peak
radial velocity measurement</p>
</dd>
<dt>line_significants: <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 5)</dt><dd><p>The sigma-level for the spectral line to be above the continuum
in order to be considered <em>valid</em></p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="monte-carlo-radial-velocity-determination">
<span id="monte-carlo"></span><h3><span class="section-number">3.2.2. </span>Monte Carlo radial velocity determination<a class="headerlink" href="#monte-carlo-radial-velocity-determination" title="Permalink to this headline">¶</a></h3>
<p>This is the module that performs the Monte Carlo boot strapping to measure radial velocities. It is automatically called by the <a class="reference internal" href="#radial_velocities.RV_spectrum.rv_fit" title="radial_velocities.RV_spectrum.rv_fit"><code class="xref py py-class docutils literal notranslate"><span class="pre">radial_velocities.RV_spectrum.rv_fit</span></code></a> attribute of <a class="reference internal" href="#radial_velocities.RV_spectrum" title="radial_velocities.RV_spectrum"><code class="xref py py-class docutils literal notranslate"><span class="pre">radial_velocities.RV_spectrum</span></code></a> class and there is no need to repeat this step manually. Nevertheless, we show this part of the code since it may be useful for other applications to measure RVs.</p>
<span class="target" id="module-ppxf_MC"></span><dl class="function">
<dt id="ppxf_MC.ppxf_MC">
<code class="sig-prename descclassname">ppxf_MC.</code><code class="sig-name descname">ppxf_MC</code><span class="sig-paren">(</span><em class="sig-param">log_template_f</em>, <em class="sig-param">log_spec_f</em>, <em class="sig-param">log_spec_err</em>, <em class="sig-param">velscale</em>, <em class="sig-param">guesses</em>, <em class="sig-param">nrand=100</em>, <em class="sig-param">degree=4</em>, <em class="sig-param">goodpixels=None</em>, <em class="sig-param">moments=4</em>, <em class="sig-param">vsyst=0</em>, <em class="sig-param">sigma=5</em>, <em class="sig-param">spec_id=None</em>, <em class="sig-param">RV_guess_var=0.0</em>, <em class="sig-param">n_CPU=-1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ppxf_MC.html#ppxf_MC"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ppxf_MC.ppxf_MC" title="Permalink to this definition">¶</a></dt>
<dd><p>This module runs the Monte Carlo <a class="reference external" href="http://www-astro.physics.ox.ac.uk/~mxc/software/#ppxf">ppxf</a> runs, which is needed for the RV
measurements. Most of the input parameters are similar to the standard
ppxf parameters (see <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2004PASP..116..138C/abstract">Cappellari and Emsellem 2004</a>) for a more detailed
explanation).</p>
<dl>
<dt>Args:</dt><dd><dl>
<dt>log_template_f<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>The logarithmically binned template spectrum</p>
</dd>
<dt>log_spec_f<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>The logarithmically binned source spectrum</p>
</dd>
<dt>log_spec_err<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>The logarithmically source spectrum uncertainties</p>
</dd>
<dt>velscale: <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></dt><dd><p>The velocity scale of the source spectrum</p>
</dd>
<dt>guesses<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a></span></dt><dd><p>The initial guesses for the the radial velocity fit guesses in
the form [RV,sepctral_dispersion]</p>
</dd>
</dl>
</dd>
<dt>Kwargs:</dt><dd><dl>
<dt>nrand<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 5)</span></dt><dd><p>The maximum number of iteration if convergence is not reached</p>
</dd>
<dt>degree<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 4)</span></dt><dd><p>The degree of the additive polynomial to fit offsets in the
continuum. A low order polynominal may be needed to get better
results</p>
</dd>
<dt>goodpixels<span class="classifier"><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a> (optional, default: 5)</span></dt><dd><p>A <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a>: of pixels that are used by ppxf to fit
the template to the source spectrum</p>
</dd>
<dt>moments<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 4)</span></dt><dd><p>The moments to be fit (v, sigma, h3, h4)</p>
</dd>
<dt>vsyst<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> (optional, default: 0.)</span></dt><dd><p>A systematic velocity. This may be needed if the system move at
high velocities compared to the rest frame. If the guess of vsyst
is good, the fit runs faster and more stable.</p>
</dd>
<dt>sigma<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: 5)</span></dt><dd><p>The sigma used to clip outliers in the histogram determination.</p>
</dd>
<dt>spec_id<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> (optional, default: None)</span></dt><dd><p>An ID number of the source spectrum. This becomes handy when
fitting many individual sources because the output files will be
named with the ID.</p>
</dd>
<dt>RV_guess_var<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a> (optional, default: 0)</span></dt><dd><p>The maximum variation the RV guess will be varied using a 
uniform distribution.</p>
</dd>
<dt>n_CPU<span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> (optional, default: -1)</span></dt><dd><p>The number of cores used for the Monte Carlo velocity fitting. If
n_CPU=-1 than all available cores will be used.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="history">
<h2><span class="section-number">3.3. </span>History<a class="headerlink" href="#history" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.1.0: </span>working radial velocity fitting package</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.1.0: </span>no RV calculation for lines that are below the significance level</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.1.0: </span>instrument dispersion added as keyword</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.1.1: </span>moved to pep-8</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.1.2: </span>now handles absorption and emission lines. <strong>Not tested yet, though</strong></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.1.3: </span>During the boot strap procedure, the initial guesses of the velocities are varied between certain limits, to ensure more stability to the
fit in the case of an “unlucky choice of initial parameters. Added Kwarg to <code class="xref py py-mod docutils literal notranslate"><span class="pre">RV_spectrum.rv_fit</span></code> is <cite>RV_guess_var</cite>, which is by default 0.
It describes the min/max variation of the initial RV guess for each fit.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.0: </span>The release version as originally published in <a class="reference external" href="www.xyz.com">Zeidler et al. 2019</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cubes.html" class="btn btn-neutral float-right" title="4. Cubes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="MUSEreduce.html" class="btn btn-neutral float-left" title="2. MUSEreduce" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Peter Zeidler

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>